<br>

<center>
    <h2>Analysis Result</h2>
    <br>
    <table style="width:30%;">
        <tr>
            <td style="padding:3px;border:2px solid rgb(212, 212, 212)">
                DETECTIONS
            </td>
            <td style="padding:3px;border:2px solid rgb(212, 212, 212)" id="counter">
                0
            </td>
            <td style="padding:3px;border:2px solid rgb(212, 212, 212);display:none">
                &nbsp;&nbsp; <button style="margin-top: 5px;" type="submit" class="btn btn-success">Save
                    Document</button>
            </td>
        </tr>
    </table>
</center>
<br>
<center style="border: 3px; border-style: solid; border-color:#4BB777; padding:30px; width:50%; margin:auto;">

    <p class="lead" style="text-align: justify;" id="data">{{plaintext}}</p>
</center>

<br>
<br><br>
<br><br>
<br><br>
<br><br>
<br><br>
<br><br>
<br><br>
<br><br>
<br><br>
<br>


<script>
    let keywords = ["system", "dolor"];
    document.addEventListener("DOMContentLoaded", function (event) {


        process();
        Tipped.create(".simple-tooltip");

        Tipped.create(
            "#32",
            function (element) {
                let id = 8321;
                element.id = id;
                return {
                    title: $(element).data("title"),
                    content: `<a href='#' onclick='change_word(${id},"new Thing")'> Other Word </a> <br>  <a href='#'> Synynom 2 </a>`,
                };
            },
            {
                skin: "light",
            }
        );
    });
    function process() {

        var dialog = bootbox.dialog({

            message: `  <b style='font-size:13pt;'> Processing Document </b>    
            <div class="progress" style='height:40px;'>
  <div class="progress-bar" style='height:38px;padding-top:10px !important;font-size:14pt;' role="progressbar" style="width: 10%;" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"><center>10% </center></div>
</div
           `,
            closeButton: false,
            centerVertical: true


        });


        sub_prog();


        setTimeout(function () {
            let progress = 30;
            $('.progress-bar').css('width', progress + '%').attr('aria-valuenow', progress);
            $('.progress-bar').html(progress + '%')

        }, 200);
        $.ajax({
            type: "GET",
            url: "/keywords",
            success: function (data) {
                console.clear();
                let words = [];

                data.forEach(function (element) {

                    words.push(element.keyword);
                });

                setTimeout(function () {
                    let progress = 90;
                    $('.progress-bar').css('width', progress + '%').attr('aria-valuenow', progress);
                    $('.progress-bar').html(progress + '%')

                }, 900);

                setTimeout(function () {
                    let progress = 100;
                    $('.progress-bar').css('width', progress + '%').attr('aria-valuenow', progress);
                    $('.progress-bar').html(progress + '%')

                }, 1200);

                setTimeout(function () {

                    dialog.find('.bootbox-body').html('<center style="font-size:25pt;color:green;"> <i class="fa fa-check-circle"></i> Done.  </center>');
                    bootbox.hideAll();
                    let doc = $("#data");
                    let count = 0;
                    var instance = new Mark(doc);

                    console.log(words);
                    var x = instance.mark(words, {
                        element: "span",
                        className: "highlight",
                        each: (ele) => {
                            count = count + 1;
                        }
                    });

                    $("#counter").html("<b>" + count + "</b> Words")

                }, 2200);

            },
            error: function (error) {
                alert("error , please try again");
            }
        })


    }

    function change_word(element, new_word) {
        $("#" + element).text(new_word);
    }
</script>

<style>
    body {}

    .modal-open .modal {
        display: flex !important;
        align-items: center;
        justify-content: center;
    }

    .highlight {
        background: orange;
        color: black;
    }

    mark {
        background: orange;
        color: black;
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
    integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"
    integrity="sha512-19TrqSGVSwaC2IDGHrD+tAkX59/w5cXy0BHDVwn7OJQXxavORhFSFM7DOO9soXKuo8O7gGNHiG9R2vFrXRBcTQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="./tipped.js"></script>

<link rel="stylesheet" href="./node_modules/@staaky/tipped/dist/css/tipped.css" />